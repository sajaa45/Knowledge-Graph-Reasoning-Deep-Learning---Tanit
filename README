
````markdown
# Fertility Medical Reasoner

This repository provides a small, fine-tuned medical reasoning model for fertility clinics.  
All code and demos are available in `notebook/demo.ipynb`.

## 1. Requirements

Install the necessary dependencies before running any scripts:

```bash
pip install torch transformers datasets peft trl unsloth huggingface_hub tqdm jupyterlab
````

Login to Hugging Face to access the base models:

```python
from huggingface_hub import notebook_login
notebook_login()
```

## 2. Data Preparation

The script `train/00_prepare_mixture.py` handles:

* Cleaning and preprocessing raw datasets
* Combining multiple data sources into a curated mixture
* Formatting datasets for chain-of-thought (CoT) supervised fine-tuning

Run this script first to generate `data/processed/final_mix/`.

## 3. Model Fine-Tuning

The script `train/qlora_sft.py` performs QLoRA-based supervised fine-tuning:

* Uses `SmolLM3-3B-Base` as the base model
* Applies LoRA adapters for parameter-efficient tuning
* Supports long-context reasoning (up to 32k tokens)
* Saves the fine-tuned model to `models/sft_smollm3/`

## 4. Evaluation

The repository provides two evaluation scripts:

* `evaluation/run_all_benchmarks.py`
  Evaluates the **fine-tuned model** on curated medical reasoning datasets (MedQA, MedMCQA, PubMedQA, MMLU-Clinical).

* `evaluation/run_batch_eval_base_model.py`
  Evaluates the **base model** for comparison on the same datasets.

Both scripts report per-dataset accuracy, overall performance, and highlight differences between yes/no reasoning and multiple-choice grounding.

## 5. Inference and Use Cases

Use `inference/stream_medical_cot.py` for interactive testing:

* Load the fine-tuned model
* Provide new patient cases or PDF summaries
* Observe chain-of-thought reasoning traces and recommended clinical actions

This script is ideal for running curated fertility cases or testing new patient data.

## 6. Demo

A working demo is provided in `notebook/demo.ipynb`, which includes:

* Loading the fine-tuned model
* Running evaluation benchmarks
* Testing inference on sample fertility cases with CoT reasoning

```

If you want, I can also make a **nicely formatted PDF-ready LaTeX version** of this README with sections, bullet points, and highlighted code blocks. Do you want me to do that?
```
